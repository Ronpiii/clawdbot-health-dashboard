# 2026-02-26

## nightly build: diff-aware code review (00:00 UTC)

### what
- built `arc review` — local code review bot that checks recent changes for quality issues
- 13 check types: console.log, TODO/FIXME/HACK, `any` types, empty catch, hardcoded secrets, eslint-disable, non-null assertions, magic numbers, nested ternaries, timer leaks, sync I/O in server context, debugger/alert, large diffs
- smart false-positive suppression — hardest part was avoiding flagging the tool's OWN check patterns

### modes
- `arc review` — uncommitted changes (default)
- `arc review --commits N` — last N commits
- `arc review --since YYYY-MM-DD` — since date
- `arc review --project <name>` — filter to one project
- `arc review --strict` — enable nitpick checks (non-null assertions, magic numbers, test coverage gaps)

### first run findings
- uncommitted across 4 repos: 37 files, score 55/100
- real findings: empty catch, nested ternaries in tuner, large diffs
- anivia last 10 commits: found 6 debug console.logs in campaigns/actions.ts — leftover from debugging session
- tuner last 3 commits: timer leak in setTimeout + 353-line new page component

### design decisions
- severity weights: critical=20, high=10, medium=5, low=2, info=0. score = 100 - sum(weights)
- CLI scripts (.mjs, scripts/) exempt from console.log checks
- regex patterns, .test() calls, string literals excluded from type/catch/lint checks to prevent self-flagging
- `debugger` only flagged when it's a standalone statement, not a string containing the word
- CI exit code: exits 1 when score <40 (could wire into git hooks)
- nested ternary detection excludes nullish coalescing (??) and regex question marks

### relationship to arc debt
- `arc debt` = snapshot of total accumulated debt across whole codebase
- `arc review` = diff of new quality issues in recent changes
- complementary: debt for weekly audits, review for pre-push gates
- together they answer "is our code quality improving or declining?"
