# 2026-02-25

## nightly build: technical debt scanner (00:00 UTC)

### what
- built `arc debt` — scans all projects for code quality signals indicating accumulated technical debt
- 7 categories: TODO/FIXME, HACK/XXX, large files, console.log debris, TS `any` types, disabled lint rules, deep nesting, god files
- density-based scoring (debt per file, not raw totals) — key design decision
- snapshot tracking for trend analysis over time

### first run findings (6 projects, 422 files)
- 411 total debt items, overall score 36/100
- deep nesting dominates: 222 items (54%) — mostly React JSX + nested callbacks
- context-memory is densest: 103 items across 29 files = 8/100
- anivia has most items (170) but spread across 211 files = 39/100
- tuner cleanest at 65/100
- top debt hotspot: context-memory/cli/src/index.ts (20 console.logs, 11 `any` types)
- 114 high-severity items total, 12 TODOs, 2 HACKs

### design decisions
- CLI scripts (.mjs) excluded from console.log detection — they use it for output, not debugging
- TODO/FIXME only counted in comments, not string literals or data structures
- projects/ subdirectory excluded from root repo walk to prevent double-counting files
- density formula: `100 * exp(-density/2)` where density = weighted items / file count
- this means large clean projects score higher than small dirty ones — the right behavior

## ventok.eu contact form wired up (15:08 UTC)
- found: form was purely cosmetic — `onSubmit` just toggled a "submitted" state, never sent data
- created `/api/contact.php` on www.ventok.eu — receives JSON POST, validates, sends via Resend API
- uses anivia's Resend credentials (re_2pkNvtV7...), sends from `noreply@ventok.eu` to `ronald@ventok.eu`
- reply-to set to submitter's email so ron can reply directly
- nice HTML email template with indigo header, field table, interest tags
- `contact-handler.js` injected into all 11 HTML pages — intercepts React's fake submit, does real POST
- rate limiting: 3 requests per 5 min per IP, honeypot field for bots
- test email sent successfully via API
- files: `htdocs/api/contact.php`, `htdocs/contact-handler.js`, patched `.htaccess`

## posthog analytics added to ventok.eu (16:50 UTC)
- project key: `phc_fyQC5xU0SiioU9z00o0d3LVAzqLoI64dCLg05Jx6wca`
- project ID: 132205, region: EU Cloud
- api_host: `https://eu.i.posthog.com` (direct, no reverse proxy)
- snippet injected into all 11 HTML pages via `</head>` replacement
- ron asked about managed reverse proxy (CNAME for www.ventok.eu) — advised AGAINST it bc it would break the site. would need a subdomain like `ph.ventok.eu` if ever wanted. not worth it for B2B.
- added custom contact form funnel events to `contact-handler.js`:
  - cta_clicked, contact_panel_opened/closed, contact_form_started, contact_interest_toggled
  - contact_form_submitted (with interests, has_company, has_message props)
  - contact_form_success, contact_form_error, contact_form_validation_error
- posthog confirmed working — session replay captured

## ventok.eu responsive design audit — full implementation (16:55 UTC)
- ron provided a comprehensive mobile audit (12 items, 3 critical → 3 minor)
- implemented ALL items across all 11 HTML pages

### critical/high fixes
- **mobile nav**: created `mobile-nav.js` — hamburger button + slide-out drawer with services accordion, lang toggle, CTA
- **hero padding**: `pt-24 sm:pt-32 lg:pt-40 pb-16 sm:pb-24 lg:pb-32`
- **section padding**: all py-28/py-32 sections now responsive with py-14 base

### medium fixes
- heading sizes: `text-[28px] sm:text-[36px] lg:text-[52px]` pattern
- notification pill: `left-6 right-6 sm:left-auto` to prevent overflow
- about section: `gap-8 md:gap-16`, `mt-10 md:mt-16`
- services heading: `mb-10 md:mb-20`

### low/minor fixes
- card padding: `p-6 md:p-8 lg:p-10`
- contact form: `grid-cols-1 sm:grid-cols-2`
- "escape the Excel trap" → now links to /services
- hero tracking responsive: `tracking-[-1.5px] sm:[-2px] lg:[-3px]`
- footer copyright: `flex-wrap gap-1`

### key technical issue: tailwind CSS missing utilities
- static Next.js export = CSS generated at build time
- new responsive classes (sm:pt-32, md:py-20, etc.) didn't exist in the built CSS
- created `responsive-fixes.css` — supplemental stylesheet with all missing utility definitions
- injected into all pages alongside the class changes

### key lesson: React hydration vs JS DOM manipulation
- initial approach: mobile-nav.js manipulated nav classes (added `hidden lg:flex`)
- React hydration re-rendered DOM and reverted class changes — desktop nav still showed on mobile
- **fix**: switched to CSS-based approach (`display: none !important` via media query in responsive-fixes.css)
- hamburger button injection made resilient with MutationObserver + polling interval to survive hydration
- LESSON: for static Next.js sites, prefer CSS over JS for layout changes — CSS can't be overridden by hydration

### round 2 fixes (17:07 UTC) — from ron's phone screenshots
- desktop nav STILL showing on mobile — confirmed React hydration issue, applied CSS fix
- CTAs side-by-side looked awkward — added `flex-direction: column` below 640px
- service cards grid — reset col-span to single column below 768px
- service nav tabs — horizontal scroll on mobile

### files on www.ventok.eu/htdocs
- `responsive-fixes.css` — supplemental Tailwind utilities + mobile overrides
- `mobile-nav.js` — hamburger menu + drawer
- `contact-handler.js` — form submission + posthog funnel tracking
- `api/contact.php` — Resend API email handler
- all 11 `.html` files patched (responsive classes, script/css includes, posthog snippet)

### round 3 — still broken (17:26 UTC)
- ron sent screenshot: hamburger menu STILL not visible, too much whitespace above hero
- investigation: files exist on server, served with 200, but...
- **ROOT CAUSE: aggressive caching** — `.htaccess` had `ExpiresByType text/css "access plus 1 year"` and same for JS
- ron's browser cached the old (pre-fix) versions of responsive-fixes.css and mobile-nav.js
- they would NEVER re-request until cache expires or manual clear

### fixes applied
1. added `?v=3` cache-busting params to all CSS/JS includes across all 11 HTML files
2. fixed `.htaccess` caching policy:
   - custom CSS/JS now `max-age=300` (5 min) — not hashed, needs short cache
   - Next.js `_next/` assets keep `max-age=31536000, immutable` — hashed filenames handle versioning
3. added hero whitespace reduction in responsive-fixes.css:
   - mobile `padding-top: 3rem` (was 6rem/pt-24)
   - mobile `padding-bottom: 3rem`
   - gradient blob pushed further up (`top: -300px`)
   - hero h1 margin-top reduced to 0.75rem
   - CTA buttons margin-top reduced to 2rem

### .htaccess 500 — caught and fixed immediately
- `<Directory>` block inside .htaccess caused 500 — not valid in .htaccess context
- simplified to just `ExpiresByType` with 5min cache for CSS/JS, 1yr for images
- verified: all assets serving 200 with `max-age=300`

### LESSON: .htaccess does NOT support `<Directory>` directives — only server config does.

## active state — ventok.eu mobile
- all fixes deployed and serving correctly
- ron needs to hard-refresh (or just open in incognito/private) to pick up `?v=3` cache-busted files
- hamburger menu + reduced hero whitespace should both work now

## blockers (unchanged)
- git push blocked — no github auth on this host
- brave API key missing — no web search / reddit pulse
